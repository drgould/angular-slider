"use strict";angular.module("drg.slider",[]),angular.module("drg.slider").directive("drgSliderBar",function(){return{restrict:"EA",require:"^drgSlider",compile:function(n,e){return function(n,e,o,t){function r(){var o=t.valueToPercent(n.low,n.lowKnob?n.lowKnob.elem:null,!0),r=t.valueToPercent(n.high,n.highKnob?n.highKnob.elem:null,!0)-o;e.css(t.options.vertical?{top:o+"%",height:r+"%"}:{left:o+"%",width:r+"%"})}n.low=0,n.high=0,n.lowKnob=null,n.highKnob=null;var i=t.registerBar({elem:e,scope:n,onStart:function(){e.addClass("active")},onChange:function(){r()},onEnd:function(){e.removeClass("active")}});o.$observe("low",function(e){n.low=e,r()}),o.$observe("high",function(e){n.high=e,r()});var a=["mousedown","touchstart"];window.PointerEvent?a=["pointerdown"]:window.navigator.MSPointerEnabled&&(a=["MSPointerDown"]),angular.forEach(a,function(n){e.bind(n,function(n){n.preventDefault(),n.stopPropagation(),i.start(n)})})}}}}),angular.module("drg.slider").controller("SliderCtrl",["$scope","$timeout",function(n,e){function o(n,e){var o=n.ngModel.$modelValue,t=e.ngModel.$modelValue;return o>t?1:t>o?-1:0}function t(){n.knobs.sort(o),angular.forEach(n.knobs,function(e){e.ngModel.$modelValue=Math.max(n.floor,Math.min(e.ngModel.$modelValue,n.ceiling))})}function r(){n.bars.push({low:function(){return 0},high:function(){return 0}})}function i(){n.bars.splice(0,1)}function a(){function e(e){return function(){return e>0?n.knobs[e-1].ngModel.$modelValue:n.floor}}function o(e){return function(){return e<n.knobs.length?n.knobs[e].ngModel.$modelValue:n.ceiling}}for(var t=n.knobs.length;n.bars.length<t+1;)r();for(;n.bars.length>t+1;)i();angular.forEach(n.bars,function(n,t){n.low=e(t),n.high=o(t)}),angular.forEach(s,function(e,o){e.scope.lowKnob=o>0?n.knobs[o-1]:null,e.scope.highKnob=o<n.knobs.length?n.knobs[o]:null,e.onChange&&e.onChange()})}n.knobs=[],n.bars=[];var s=[];n.currentKnobs=[],n.startOffsets=[],n.sliding=!1,this.defaultOptions={precision:0,buffer:0,steps:0,addStepNumbers:!1,stickiness:3,scale:function(n){return n},continuous:!1,vertical:!1},this.options=this.defaultOptions;var l=this;n.fix=function(){t(),a()},this.valueToPercent=function(e,o,t){var r=0;o&&(r=this.options.vertical?o[0].offsetHeight:o[0].offsetWidth);var i=r/n.dimensions().sliderSize*100,a=(parseFloat(e)-n.floor)/(n.ceiling-n.floor)*(100-i);return t&&o&&(a+=i/2),a},this.registerKnob=function(e){function o(o){var t=n.ceiling,r=n.floor,i=parseFloat(o),a=n.knobs.indexOf(e);if(l.options.continuous||(a>0&&(r=parseFloat(n.knobs[a-1].ngModel.$modelValue)+(l.options.buffer>0?l.options.buffer:0)),a<n.knobs.length-1&&(t=parseFloat(n.knobs[a+1].ngModel.$modelValue)-(l.options.buffer>0?l.options.buffer:0))),l.options.steps>1){var s=(n.ceiling-n.floor)/(l.options.steps-1);if(a>0){var u=(r-n.floor)%s;u>0&&(r+=s-u)}if(a<n.knobs.length-1){var c=(t-n.floor)%s;c>0&&(t-=c)}var f=(i-n.floor)%s;s/2>f?i-=f:i+=s-f}i=Math.min(t,Math.max(i,r)),l.options.precision>=0&&(i=parseFloat(i.toFixed(l.options.precision))),i===o?e.onChange&&e.onChange(o):isNaN(i)||(e.ngModel.$setViewValue(i),n.$$phase||n.$apply())}function t(e){r&&(o(e),n.fix(),n.$$phase||n.$apply())}var r=!0;return n.knobs.push(e),n.$watch(function(){return e.ngModel.$modelValue},function(n){t(n)}),n.$watch(function(){return l.options},function(){t(e.ngModel.$modelValue)},!0),a(),e.elem.on("$destroy",function(){n.knobs.splice(n.knobs.indexOf(e),1),r=!1}),{start:function(o){n.disabled||(angular.isDefined(o.targetTouches)?n.currentKnobs[o.targetTouches[0].identifier]=[e]:n.currentKnobs[0]=[e],n.sliding=!0,n.onStart(o),e.onStart())},disabled:function(){var o=n.currentKnobs.indexOf(e);n.sliding&&o>=0&&n.onEnd(o)}}},this.registerBar=function(e){return s.push(e),e.elem.on("$destroy",function(){var n=s.indexOf(e);n>=0&&s.splice(n,1)}),{start:function(o){if(!n.disabled){var t=[];e.scope.lowKnob&&t.push(e.scope.lowKnob),e.scope.highKnob&&t.push(e.scope.highKnob),angular.isDefined(o.targetTouches)?n.currentKnobs[o.targetTouches[0].identifier]=t:n.currentKnobs[0]=t,n.sliding=!0,n.onStart(o),e.onStart()}}}}}]),angular.module("drg.slider").directive("drgSlider",["$document","$compile","$interpolate",function(n,e,o){return{restrict:"EA",controller:"SliderCtrl",scope:!0,compile:function(t,r){if(angular.isUndefined(r.floor))throw"ngSlider Error: Floor not specified";if(angular.isUndefined(r.ceiling))throw"ngSlider Error: Ceiling not specified";return function(t,r,i,a){function s(n,e){var o=-1*t.dimensions().sliderOffset;return o+=a.options.vertical?n.touches?n.touches[e].pageY:n.pageY:n.touches?n.touches[e].pageX:n.pageX}function l(n){var e=a.options.vertical?n[0].offsetTop:n[0].offsetLeft;return e-t.dimensions().sliderOffset}r.prepend(e('<drg-slider-bar low="'+o.startSymbol()+" bar.low() "+o.endSymbol()+'" high="'+o.startSymbol()+" bar.high() "+o.endSymbol()+'" ng-repeat="bar in bars"></ng-slider-bar>')(t)),t.dimensions=function(){var n=a.options.vertical?r[0].offsetTop:r[0].offsetLeft;return r[0].offsetParent&&(n+=a.options.vertical?r[0].offsetParent.offsetTop:r[0].offsetParent.offsetLeft),{sliderSize:a.options.vertical?r[0].offsetHeight:r[0].offsetWidth,sliderOffset:n}},t.onStart=function(n){var e=0;if(n.targetTouches&&(e=n.targetTouches[0].identifier),angular.isArray(t.currentKnobs[e])&&t.currentKnobs[e].length>1){var o=s(n,e);t.startOffsets[e]=t.currentKnobs[e].map(function(n){return l(n.elem)-o})}else t.startOffsets[e]=[0];t.onMove(n)},t.onMove=function(n){var e=t.dimensions();angular.forEach(t.currentKnobs,function(o,r){if(t.currentKnobs[r]){var i=s(n,r),l=t.startOffsets[r];angular.isArray(o)||(o=[o]);for(var u=0;u<o.length;u++){var c=a.options.vertical?o[u].elem[0].offsetHeight:o[u].elem[0].offsetWidth,f=Math.max(0,Math.min((i+l[u]-c/2)/(e.sliderSize-c),1)),d=(f*(t.ceiling-t.floor)+t.floor).toFixed(a.options.precision);o[u].ngModel.$setViewValue(d),t.$$phase||t.$apply()}}})},t.onEnd=function(n){var e=t.currentKnobs[n]||[];n<t.currentKnobs.length&&delete t.currentKnobs[n],angular.isArray(e)||(e=[e]),angular.forEach(e,function(n){n.onEnd()}),0==t.currentKnobs.length&&(t.sliding=!1)},t.onResize=function(){t.fix()};var u=["mousemove","touchmove"],c=["mousecancel","touchcancel"],f=["mouseup","touchend"];window.PointerEvent?(u=["pointermove"],c=["pointercancel"],f=["pointerup"]):window.navigator.msPointerEnabled&&(u=["MSPointerMove"],c=["MSPointerCancel"],f=["MSPointerUp"]),angular.forEach(u,function(e){n.bind(e,function(n){t.sliding&&(n.preventDefault(),n.stopPropagation(),t.onMove(n))})}),angular.forEach(c.concat(f),function(e){n.bind(e,function(n){if(t.sliding)if(n.changedTouches)for(var e=0;e<n.changedTouches.length;e++)t.onEnd(n.changedTouches[e].identifier);else t.onEnd(0)})}),t.$watch(function(){return t.$eval(i.ngDisabled)},function(n){t.disabled=angular.isDefined(n)&&n,t.disabled?r.addClass("disabled"):r.removeClass("disabled"),t.sliding&&angular.forEach(t.currentKnobs.keys(),function(n){t.onEnd(n)})}),i.$observe("ceiling",function(n){n=angular.isDefined(n)?parseFloat(n):0,t.ceiling=isNaN(n)?0:n,t.onResize()}),i.$observe("floor",function(n){n=angular.isDefined(n)?parseFloat(n):0,t.floor=isNaN(n)?0:n,t.onResize()}),t.$watch(function(){return t.$eval(i.drgSliderOptions)},function(n){a.options=angular.extend({},a.defaultOptions,angular.isDefined(n)&&angular.isObject(n)?n:{}),a.options.vertical?r.addClass("drg-slider-vertical").removeClass("drg-slider-horizontal"):r.addClass("drg-slider-horizontal").removeClass("drg-slider-vertical")},!0),t.$on("drgSlider.resize",t.onResize)}}}}]),angular.module("drg.slider").directive("drgSliderKnob",["$parse",function(n){return{restrict:"EA",require:["^drgSlider","^ngModel"],scope:!0,compile:function(e,o){if(angular.isUndefined(o.ngModel))throw"ngSliderKnob Error: ngModel not specified";return function(e,o,t,r){function i(o){n(t.ngModel).assign(e.$parent.$parent,parseFloat(o)),e.$$phase||e.$apply()}var a=r[0],s=r[1];e.enabled=!0;var l=a.registerKnob({ngModel:s,elem:o,onChange:function(n){i(n),e.$viewValue=n,o.css(a.options.vertical?"top":"left",a.valueToPercent(n,o)+"%")},onStart:function(){o.addClass("active")},onEnd:function(){o.removeClass("active")}});e.$watch(function(){return e.$eval(t.ngDisabled)},function(n){e.enabled=!n,n?o.addClass("disabled"):o.removeClass("disabled"),e.enabled||l.disabled()});var u=["mousedown","touchstart"];window.PointerEvent?u=["pointerdown"]:window.navigator.MSPointerEnabled&&(u=["MSPointerDown"]),angular.forEach(u,function(n){o.bind(n,function(n){n.preventDefault(),n.stopPropagation(),l.start(n)})})}}}}]);
//# sourceMappingURL=drg-slider.min.js.map