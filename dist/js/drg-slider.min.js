/**
 * angular-slider
 * @version 1.0.0-alpha.1
 * @copyright Derek Gould 2015
 * @license MIT
 */
"use strict";angular.module("drg.slider",[]),angular.module("drg.slider").directive("drgSliderBar",function(){return{restrict:"EA",require:"^drgSlider",compile:function(n,e){return function(n,e,o,t){function i(){var o=t.valueToPercent(n.low,n.lowKnob?n.lowKnob.elem:null,!0),i=t.valueToPercent(n.high,n.highKnob?n.highKnob.elem:null,!0)-o;t.options.vertical?e.css({top:o+"%",height:i+"%"}):e.css({left:o+"%",width:i+"%"})}n.low=0,n.high=0,n.lowKnob=null,n.highKnob=null;var r=t.registerBar({elem:e,scope:n,onStart:function(){e.addClass("active")},onChange:function(){i()},onEnd:function(){e.removeClass("active")}});o.$observe("low",function(e){n.low=e,i()}),o.$observe("high",function(e){n.high=e,i()});var s=["mousedown","touchstart"];window.PointerEvent?s=["pointerdown"]:window.navigator.MSPointerEnabled&&(s=["MSPointerDown"]),angular.forEach(s,function(n){e.bind(n,function(n){n.preventDefault(),n.stopPropagation(),r.start(n)})})}}}}),angular.module("drg.slider").controller("SliderCtrl",["$scope","$timeout",function(n,e){function o(n,e){var o=n.ngModel.$modelValue,t=e.ngModel.$modelValue;return o>t?1:t>o?-1:0}function t(){n.knobs.sort(o)}function i(){t(),angular.forEach(n.knobs,function(e){e.ngModel.$modelValue=Math.max(n.floor,Math.min(e.ngModel.$modelValue,n.ceiling))})}function r(){n.bars.push({low:function(){return 0},high:function(){return 0}})}function s(){n.bars.splice(0,1)}function a(){function e(e){return function(){return e>0?n.knobs[e-1].ngModel.$modelValue:n.floor}}function o(e){return function(){return e<n.knobs.length?n.knobs[e].ngModel.$modelValue:n.ceiling}}for(var t=n.knobs.length;n.bars.length<t+1;)r();for(;n.bars.length>t+1;)s();angular.forEach(n.bars,function(n,t){n.low=e(t),n.high=o(t)}),angular.forEach(d,function(e,o){e.scope.lowKnob=o>0?n.knobs[o-1]:null,e.scope.highKnob=o<n.knobs.length?n.knobs[o]:null,e.onChange&&e.onChange()})}function l(e){var o=arguments.length<=1||void 0===arguments[1]?n.floor:arguments[1],t=arguments.length<=2||void 0===arguments[2]?n.ceiling:arguments[2],i=arguments.length<=3||void 0===arguments[3]?!1:arguments[3],r=arguments.length<=4||void 0===arguments[4]?h.options.values:arguments[4];if(!h.isEqualSpacing()||i){for(var s=0;s<r.length-1;s++)if(e>=r[s]&&e<=r[s+1]){if(r[s]<o&&r[s+1]>t)return;return r[s]<o?r[s+1]:r[s+1]>t?r[s]:r[s+Math.round((e-r[s])/(r[s+1]-r[s]))]}if(!(r[r.length-1]>t))return r[r.length-1]}else for(var a=(e-n.floor)/(n.ceiling-n.floor),l=Math.round(a*(r.length-1));l>=0&&l<r.length;)if(r[l]<o){if(r[l+1]>t)return;l++}else{if(!(r[l]>t))return r[l];if(r[l-1]<o)return;l--}}var u=this,c="equal",f="relative";n.knobs=[],n.bars=[];var d=[];n.currentKnobs=[],n.startOffsets=[],n.sliding=!1,this.defaultOptions={precision:0,buffer:0,steps:0,values:[],spacing:f,continuous:!1,vertical:!1},this.options=this.defaultOptions;var g,h=this;n.fix=function(){e.cancel(g),g=e(function(){i(),a()},25)},this.valueToPercent=function(e,o,t){var i=0;o&&(i=this.options.vertical?o[0].offsetHeight:o[0].offsetWidth);var r=i/n.dimensions().sliderSize*100,s=1;if(e=parseFloat(e),h.useValues()){for(var a=h.options.values,l=0;l<a.length-1;l++)if(e>=a[l]&&e<=a[l+1]){var u=l+Math.round((e-a[l])/(a[l+1]-a[l]));s=h.isEqualSpacing()?u/(a.length-1):(a[u]-n.floor)/(n.ceiling-n.floor)}}else s=(e-n.floor)/(n.ceiling-n.floor);return s*=100-r,t&&o&&(s+=r/2),s},this.percentToValue=function(e){var o=arguments.length<=1||void 0===arguments[1]?n.floor:arguments[1],t=arguments.length<=2||void 0===arguments[2]?n.ceiling:arguments[2],i=e*(t-o)+o;return h.useValues()?l(i,o,t):i},this.toPercent=function(e){return(e-n.floor)/(n.ceiling-n.floor)},this.registerKnob=function(e){function o(o){t();var i=n.ceiling,r=n.floor,s=parseFloat(o),a=n.knobs.indexOf(e);if(h.options.continuous||(a>0&&(r=parseFloat(n.knobs[a-1].ngModel.$modelValue)+(h.options.buffer>0?h.options.buffer:0)),a<n.knobs.length-1&&(i=parseFloat(n.knobs[a+1].ngModel.$modelValue)-(h.options.buffer>0?h.options.buffer:0))),h.useValues())s=l(o,r,i,!0);else if(h.options.steps>1){var u=(n.ceiling-n.floor)/(h.options.steps-1);if(a>0){var c=(r-n.floor)%u;c>0&&(r+=u-c)}if(a<n.knobs.length-1){var f=(i-n.floor)%u;f>0&&(i-=f)}var d=(s-n.floor)%u;u/2>d?s-=d:s+=u-d}s=Math.min(i,Math.max(s,r)),h.options.precision>=0&&(s=parseFloat(s.toFixed(h.options.precision))),s===o?e.onChange&&e.onChange(o):isNaN(s)||(e.ngModel.$setViewValue(s),n.$$phase||n.$apply())}function i(e){r&&(o(e),n.fix(),n.$$phase||n.$apply())}var r=!0;return n.knobs.push(e),t(),n.$watch(function(){return e.ngModel.$modelValue},function(n){i(n)}),n.$watch(function(){return h.options},function(){i(e.ngModel.$modelValue)},!0),a(),e.elem.on("$destroy",function(){n.knobs.splice(n.knobs.indexOf(e),1),r=!1}),{start:function(o){n.disabled||(angular.isDefined(o.targetTouches)?n.currentKnobs[o.targetTouches[0].identifier]=[e]:n.currentKnobs[0]=[e],n.sliding=!0,n.onStart(o),e.onStart())},disabled:function(){var o=n.currentKnobs.indexOf(e);n.sliding&&o>=0&&n.onEnd(o)}}},this.registerBar=function(e){return d.push(e),e.elem.on("$destroy",function(){var n=d.indexOf(e);n>=0&&d.splice(n,1)}),{start:function(o){if(!n.disabled){var t=[];e.scope.lowKnob&&t.push(e.scope.lowKnob),e.scope.highKnob&&t.push(e.scope.highKnob),angular.isDefined(o.targetTouches)?n.currentKnobs[o.targetTouches[0].identifier]=t:n.currentKnobs[0]=t,n.sliding=!0,n.onStart(o),e.onStart()}}}},this.isEqualSpacing=function(){return u.options.spacing===c},this.isRelativeSpacing=function(){return u.options.spacing===f},this.useValues=function(){return h.options.values.length>1}}]),angular.module("drg.slider").directive("drgSlider",["$document","$compile","$interpolate",function(n,e,o){return{restrict:"EA",controller:"SliderCtrl",scope:!0,link:function(t,i,r,s){function a(n,e){var o=-1*t.dimensions().sliderOffset;return o+=s.options.vertical?n.touches?n.touches[e].pageY:n.pageY:n.touches?n.touches[e].pageX:n.pageX}function l(n){var e=s.options.vertical?n[0].offsetTop:n[0].offsetLeft;return e-t.dimensions().sliderOffset}i.prepend(e('<drg-slider-bar low="'+o.startSymbol()+" bar.low() "+o.endSymbol()+'" high="'+o.startSymbol()+" bar.high() "+o.endSymbol()+'" ng-repeat="bar in bars"></ng-slider-bar>')(t)),t.dimensions=function(){var n=s.options.vertical?i[0].offsetTop:i[0].offsetLeft;return i[0].offsetParent&&(n+=s.options.vertical?i[0].offsetParent.offsetTop:i[0].offsetParent.offsetLeft),{sliderSize:s.options.vertical?i[0].offsetHeight:i[0].offsetWidth,sliderOffset:n}},t.onStart=function(n){var e=0;if(n.targetTouches&&(e=n.targetTouches[0].identifier),angular.isArray(t.currentKnobs[e])&&t.currentKnobs[e].length>1){var o=a(n,e);t.startOffsets[e]=t.currentKnobs[e].map(function(n){return l(n.elem)-o})}else t.startOffsets[e]=[0];t.onMove(n)},t.onMove=function(n){var e=t.dimensions();angular.forEach(t.currentKnobs,function(o,i){if(t.currentKnobs[i]){var r=a(n,i),l=t.startOffsets[i];angular.isArray(o)||(o=[o]);for(var u=0;u<o.length;u++){var c=s.options.vertical?o[u].elem[0].offsetHeight:o[u].elem[0].offsetWidth,f=0,d=1;if(!s.options.continuous){var g=t.knobs.indexOf(o[u]);g>0&&(f=s.toPercent(t.knobs[g-1].ngModel.$modelValue)),g<t.knobs.length-1&&(d=s.toPercent(t.knobs[g+1].ngModel.$modelValue))}var h=Math.max(f,Math.min((r+l[u]-c/2)/(e.sliderSize-c),d)),p=s.percentToValue(h).toFixed(s.options.precision);o[u].ngModel.$setViewValue(p),t.$$phase||t.$apply()}}})},t.onEnd=function(n){var e=t.currentKnobs[n]||[];n<t.currentKnobs.length&&delete t.currentKnobs[n],angular.isArray(e)||(e=[e]),angular.forEach(e,function(n){n.onEnd()}),0===t.currentKnobs.length&&(t.sliding=!1)},t.onResize=function(){t.fix()};var u=".drslider"+t.$id,c=["mousemove","touchmove"],f=["mousecancel","touchcancel"],d=["mouseup","touchend"];window.PointerEvent?(c=["pointermove"],f=["pointercancel"],d=["pointerup"]):window.navigator.msPointerEnabled&&(c=["MSPointerMove"],f=["MSPointerCancel"],d=["MSPointerUp"]),angular.forEach(c,function(e){n.bind(e+u,function(n){t.sliding&&(n.preventDefault(),n.stopPropagation(),t.onMove(n))})}),angular.forEach(f.concat(d),function(e){n.bind(e+u,function(n){if(t.sliding)if(n.changedTouches)for(var e=0;e<n.changedTouches.length;e++)t.onEnd(n.changedTouches[e].identifier);else t.onEnd(0)})}),t.$watch(function(){return t.$eval(r.ngDisabled)},function(n){t.disabled=angular.isDefined(n)&&n,t.disabled?i.addClass("disabled"):i.removeClass("disabled"),t.sliding&&angular.forEach(t.currentKnobs.keys(),function(n){t.onEnd(n)})}),r.$observe("ceiling",function(n){s.useValues()||(n=angular.isDefined(n)?parseFloat(n):0,t.ceiling=isNaN(n)?0:n,t.onResize())}),r.$observe("floor",function(n){s.useValues()||(n=angular.isDefined(n)?parseFloat(n):0,t.floor=isNaN(n)?0:n,t.onResize())}),t.$watch(function(){return t.$eval(r.drgSliderOptions)},function(n){s.options=angular.extend({},s.defaultOptions,angular.isDefined(n)&&angular.isObject(n)?n:{}),s.options.values.sort(function(n,e){return n-e}),s.useValues()&&(t.floor=s.options.values[0],t.ceiling=s.options.values[s.options.values.length-1]),s.options.vertical?i.addClass("drg-slider-vertical").removeClass("drg-slider-horizontal"):i.addClass("drg-slider-horizontal").removeClass("drg-slider-vertical")},!0),t.$on("drgSlider.resize",t.onResize),t.$on("$destroy",function(){n.off(u)})}}}]),angular.module("drg.slider").directive("drgSliderKnob",["$parse","$timeout",function(n,e){return{restrict:"EA",require:["^drgSlider","^ngModel"],scope:!0,compile:function(o,t){if(angular.isUndefined(t.ngModel))throw"ngSliderKnob Error: ngModel not specified";return function(o,t,i,r){function s(e){n(i.ngModel).assign(o.$parent.$parent,parseFloat(e)),o.$$phase||o.$apply()}function a(n){t.css(l.options.vertical?"top":"left",l.valueToPercent(n,t)+"%")}var l=r[0],u=r[1];o.enabled=!0;var c=l.registerKnob({ngModel:u,elem:t,onChange:function(n){s(n),a(n),o.$viewValue=n},onStart:function(){t.addClass("active")},onEnd:function(){t.removeClass("active")}});o.$watch(function(){return o.$eval(i.ngDisabled)},function(n){o.enabled=!n,n?t.addClass("disabled"):t.removeClass("disabled"),o.enabled||c.disabled()});var f=["mousedown","touchstart"];window.PointerEvent?f=["pointerdown"]:window.navigator.MSPointerEnabled&&(f=["MSPointerDown"]),angular.forEach(f,function(n){t.bind(n,function(n){n.preventDefault(),n.stopPropagation(),c.start(n)})}),e(function(){a(o.$viewValue)})}}}}]);
//# sourceMappingURL=drg-slider.min.js.map
