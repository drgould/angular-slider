/**
 * angular-slider
 * @version 1.0.0-alpha.1
 * @copyright Derek Gould 2015
 * @license MIT
 */
"use strict";angular.module("drg.slider",[]),angular.module("drg.slider").directive("drgSliderBar",function(){return{restrict:"EA",require:"^drgSlider",compile:function(n,e){return function(n,e,o,t){function r(){var o=t.valueToPercent(n.low,n.lowKnob?n.lowKnob.elem:null,!0),r=t.valueToPercent(n.high,n.highKnob?n.highKnob.elem:null,!0)-o;e.css(t.options.vertical?{top:o+"%",height:r+"%"}:{left:o+"%",width:r+"%"})}n.low=0,n.high=0,n.lowKnob=null,n.highKnob=null;var i=t.registerBar({elem:e,scope:n,onStart:function(){e.addClass("active")},onChange:function(){r()},onEnd:function(){e.removeClass("active")}});o.$observe("low",function(e){n.low=e,r()}),o.$observe("high",function(e){n.high=e,r()});var s=["mousedown","touchstart"];window.PointerEvent?s=["pointerdown"]:window.navigator.MSPointerEnabled&&(s=["MSPointerDown"]),angular.forEach(s,function(n){e.bind(n,function(n){n.preventDefault(),n.stopPropagation(),i.start(n)})})}}}}),angular.module("drg.slider").controller("SliderCtrl",["$scope","$timeout",function(n,e){function o(n,e){var o=n.ngModel.$modelValue,t=e.ngModel.$modelValue;return o>t?1:t>o?-1:0}function t(){n.knobs.sort(o)}function r(){t(),angular.forEach(n.knobs,function(e){e.ngModel.$modelValue=Math.max(n.floor,Math.min(e.ngModel.$modelValue,n.ceiling))})}function i(){n.bars.push({low:function(){return 0},high:function(){return 0}})}function s(){n.bars.splice(0,1)}function a(){function e(e){return function(){return e>0?n.knobs[e-1].ngModel.$modelValue:n.floor}}function o(e){return function(){return e<n.knobs.length?n.knobs[e].ngModel.$modelValue:n.ceiling}}for(var t=n.knobs.length;n.bars.length<t+1;)i();for(;n.bars.length>t+1;)s();angular.forEach(n.bars,function(n,t){n.low=e(t),n.high=o(t)}),angular.forEach(d,function(e,o){e.scope.lowKnob=o>0?n.knobs[o-1]:null,e.scope.highKnob=o<n.knobs.length?n.knobs[o]:null,e.onChange&&e.onChange()})}function l(e){var o=void 0===arguments[1]?n.floor:arguments[1],t=void 0===arguments[2]?n.ceiling:arguments[2],r=void 0===arguments[3]?!1:arguments[3],i=void 0===arguments[4]?h.options.values:arguments[4];if(h.isEqualSpacing()&&!r){for(var s=(e-n.floor)/(n.ceiling-n.floor),a=Math.round(s*(i.length-1));a>=0&&a<i.length;)if(i[a]<o){if(i[a+1]>t)return void 0;a++}else{if(!(i[a]>t))return i[a];if(i[a-1]<o)return void 0;a--}return void 0}for(var l=0;l<i.length-1;l++)if(e>=i[l]&&e<=i[l+1])return i[l]<o&&i[l+1]>t?void 0:i[l]<o?i[l+1]:i[l+1]>t?i[l]:i[l+Math.round((e-i[l])/(i[l+1]-i[l]))];return i[i.length-1]>t?void 0:i[i.length-1]}var u=this,c="equal",f="relative";n.knobs=[],n.bars=[];var d=[];n.currentKnobs=[],n.startOffsets=[],n.sliding=!1,this.defaultOptions={precision:0,buffer:0,steps:0,values:[],spacing:f,continuous:!1,vertical:!1},this.options=this.defaultOptions;var g,h=this;n.fix=function(){e.cancel(g),g=e(function(){r(),a()},25)},this.valueToPercent=function(e,o,t){var r=0;o&&(r=this.options.vertical?o[0].offsetHeight:o[0].offsetWidth);var i=r/n.dimensions().sliderSize*100,s=1;if(e=parseFloat(e),h.useValues()){for(var a=h.options.values,l=0;l<a.length-1;l++)if(e>=a[l]&&e<=a[l+1]){var u=l+Math.round((e-a[l])/(a[l+1]-a[l]));s=h.isEqualSpacing()?u/(a.length-1):(a[u]-n.floor)/(n.ceiling-n.floor)}}else s=(e-n.floor)/(n.ceiling-n.floor);return s*=100-i,t&&o&&(s+=i/2),s},this.percentToValue=function(e){var o=void 0===arguments[1]?n.floor:arguments[1],t=void 0===arguments[2]?n.ceiling:arguments[2],r=e*(t-o)+o;return h.useValues()?l(r,o,t):r},this.toPercent=function(e){return(e-n.floor)/(n.ceiling-n.floor)},this.registerKnob=function(e){function o(o){t();var r=n.ceiling,i=n.floor,s=parseFloat(o),a=n.knobs.indexOf(e);if(h.options.continuous||(a>0&&(i=parseFloat(n.knobs[a-1].ngModel.$modelValue)+(h.options.buffer>0?h.options.buffer:0)),a<n.knobs.length-1&&(r=parseFloat(n.knobs[a+1].ngModel.$modelValue)-(h.options.buffer>0?h.options.buffer:0))),h.useValues())s=l(o,i,r,!0);else if(h.options.steps>1){var u=(n.ceiling-n.floor)/(h.options.steps-1);if(a>0){var c=(i-n.floor)%u;c>0&&(i+=u-c)}if(a<n.knobs.length-1){var f=(r-n.floor)%u;f>0&&(r-=f)}var d=(s-n.floor)%u;u/2>d?s-=d:s+=u-d}s=Math.min(r,Math.max(s,i)),h.options.precision>=0&&(s=parseFloat(s.toFixed(h.options.precision))),s===o?e.onChange&&e.onChange(o):isNaN(s)||(e.ngModel.$setViewValue(s),n.$$phase||n.$apply())}function r(e){i&&(o(e),n.fix(),n.$$phase||n.$apply())}var i=!0;return n.knobs.push(e),t(),n.$watch(function(){return e.ngModel.$modelValue},function(n){r(n)}),n.$watch(function(){return h.options},function(){r(e.ngModel.$modelValue)},!0),a(),e.elem.on("$destroy",function(){n.knobs.splice(n.knobs.indexOf(e),1),i=!1}),{start:function(o){n.disabled||(angular.isDefined(o.targetTouches)?n.currentKnobs[o.targetTouches[0].identifier]=[e]:n.currentKnobs[0]=[e],n.sliding=!0,n.onStart(o),e.onStart())},disabled:function(){var o=n.currentKnobs.indexOf(e);n.sliding&&o>=0&&n.onEnd(o)}}},this.registerBar=function(e){return d.push(e),e.elem.on("$destroy",function(){var n=d.indexOf(e);n>=0&&d.splice(n,1)}),{start:function(o){if(!n.disabled){var t=[];e.scope.lowKnob&&t.push(e.scope.lowKnob),e.scope.highKnob&&t.push(e.scope.highKnob),angular.isDefined(o.targetTouches)?n.currentKnobs[o.targetTouches[0].identifier]=t:n.currentKnobs[0]=t,n.sliding=!0,n.onStart(o),e.onStart()}}}},this.isEqualSpacing=function(){return u.options.spacing===c},this.isRelativeSpacing=function(){return u.options.spacing===f},this.useValues=function(){return h.options.values.length>1}}]),angular.module("drg.slider").directive("drgSlider",["$document","$compile","$interpolate",function(n,e,o){return{restrict:"EA",controller:"SliderCtrl",scope:!0,link:function(t,r,i,s){function a(n,e){var o=-1*t.dimensions().sliderOffset;return o+=s.options.vertical?n.touches?n.touches[e].pageY:n.pageY:n.touches?n.touches[e].pageX:n.pageX}function l(n){var e=s.options.vertical?n[0].offsetTop:n[0].offsetLeft;return e-t.dimensions().sliderOffset}r.prepend(e('<drg-slider-bar low="'+o.startSymbol()+" bar.low() "+o.endSymbol()+'" high="'+o.startSymbol()+" bar.high() "+o.endSymbol()+'" ng-repeat="bar in bars"></ng-slider-bar>')(t)),t.dimensions=function(){var n=s.options.vertical?r[0].offsetTop:r[0].offsetLeft;return r[0].offsetParent&&(n+=s.options.vertical?r[0].offsetParent.offsetTop:r[0].offsetParent.offsetLeft),{sliderSize:s.options.vertical?r[0].offsetHeight:r[0].offsetWidth,sliderOffset:n}},t.onStart=function(n){var e=0;if(n.targetTouches&&(e=n.targetTouches[0].identifier),angular.isArray(t.currentKnobs[e])&&t.currentKnobs[e].length>1){var o=a(n,e);t.startOffsets[e]=t.currentKnobs[e].map(function(n){return l(n.elem)-o})}else t.startOffsets[e]=[0];t.onMove(n)},t.onMove=function(n){var e=t.dimensions();angular.forEach(t.currentKnobs,function(o,r){if(t.currentKnobs[r]){var i=a(n,r),l=t.startOffsets[r];angular.isArray(o)||(o=[o]);for(var u=0;u<o.length;u++){var c=s.options.vertical?o[u].elem[0].offsetHeight:o[u].elem[0].offsetWidth,f=0,d=1;if(!s.options.continuous){var r=t.knobs.indexOf(o[u]);r>0&&(f=s.toPercent(t.knobs[r-1].ngModel.$modelValue)),r<t.knobs.length-1&&(d=s.toPercent(t.knobs[r+1].ngModel.$modelValue))}var g=Math.max(f,Math.min((i+l[u]-c/2)/(e.sliderSize-c),d)),h=s.percentToValue(g).toFixed(s.options.precision);o[u].ngModel.$setViewValue(h),t.$$phase||t.$apply()}}})},t.onEnd=function(n){var e=t.currentKnobs[n]||[];n<t.currentKnobs.length&&delete t.currentKnobs[n],angular.isArray(e)||(e=[e]),angular.forEach(e,function(n){n.onEnd()}),0==t.currentKnobs.length&&(t.sliding=!1)},t.onResize=function(){t.fix()};var u=["mousemove","touchmove"],c=["mousecancel","touchcancel"],f=["mouseup","touchend"];window.PointerEvent?(u=["pointermove"],c=["pointercancel"],f=["pointerup"]):window.navigator.msPointerEnabled&&(u=["MSPointerMove"],c=["MSPointerCancel"],f=["MSPointerUp"]),angular.forEach(u,function(e){n.bind(e,function(n){t.sliding&&(n.preventDefault(),n.stopPropagation(),t.onMove(n))})}),angular.forEach(c.concat(f),function(e){n.bind(e,function(n){if(t.sliding)if(n.changedTouches)for(var e=0;e<n.changedTouches.length;e++)t.onEnd(n.changedTouches[e].identifier);else t.onEnd(0)})}),t.$watch(function(){return t.$eval(i.ngDisabled)},function(n){t.disabled=angular.isDefined(n)&&n,t.disabled?r.addClass("disabled"):r.removeClass("disabled"),t.sliding&&angular.forEach(t.currentKnobs.keys(),function(n){t.onEnd(n)})}),i.$observe("ceiling",function(n){s.useValues()||(n=angular.isDefined(n)?parseFloat(n):0,t.ceiling=isNaN(n)?0:n,t.onResize())}),i.$observe("floor",function(n){s.useValues()||(n=angular.isDefined(n)?parseFloat(n):0,t.floor=isNaN(n)?0:n,t.onResize())}),t.$watch(function(){return t.$eval(i.drgSliderOptions)},function(n){s.options=angular.extend({},s.defaultOptions,angular.isDefined(n)&&angular.isObject(n)?n:{}),s.options.values.sort(function(n,e){return n-e}),s.useValues()&&(t.floor=s.options.values[0],t.ceiling=s.options.values[s.options.values.length-1]),s.options.vertical?r.addClass("drg-slider-vertical").removeClass("drg-slider-horizontal"):r.addClass("drg-slider-horizontal").removeClass("drg-slider-vertical")},!0),t.$on("drgSlider.resize",t.onResize)}}}]),angular.module("drg.slider").directive("drgSliderKnob",["$parse",function(n){return{restrict:"EA",require:["^drgSlider","^ngModel"],scope:!0,compile:function(e,o){if(angular.isUndefined(o.ngModel))throw"ngSliderKnob Error: ngModel not specified";return function(e,o,t,r){function i(o){n(t.ngModel).assign(e.$parent.$parent,parseFloat(o)),e.$$phase||e.$apply()}var s=r[0],a=r[1];e.enabled=!0;var l=s.registerKnob({ngModel:a,elem:o,onChange:function(n){i(n),e.$viewValue=n,o.css(s.options.vertical?"top":"left",s.valueToPercent(n,o)+"%")},onStart:function(){o.addClass("active")},onEnd:function(){o.removeClass("active")}});e.$watch(function(){return e.$eval(t.ngDisabled)},function(n){e.enabled=!n,n?o.addClass("disabled"):o.removeClass("disabled"),e.enabled||l.disabled()});var u=["mousedown","touchstart"];window.PointerEvent?u=["pointerdown"]:window.navigator.MSPointerEnabled&&(u=["MSPointerDown"]),angular.forEach(u,function(n){o.bind(n,function(n){n.preventDefault(),n.stopPropagation(),l.start(n)})})}}}}]);
//# sourceMappingURL=drg-slider.min.js.map